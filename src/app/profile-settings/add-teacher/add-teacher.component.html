<div class="container-fluid p-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">
        <i class="bi bi-person-plus-fill"></i> Manage Teachers
      </h2>
    </div>
  </div>

  <!-- Existing Teachers List -->
  <div class="row mb-4" *ngIf="teachers.length > 0">
    <div class="col-12">
      <h4>Current Teachers</h4>
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Subjects</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let teacher of teachers">
              <td>
                <code>{{ teacher.id }}</code>
              </td>
              <td>
                <strong>{{ teacher.name }}</strong>
              </td>
              <td>
                <small>{{ teacher.email }}</small>
              </td>
              <td>
                <small>{{ teacher.phone }}</small>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-1">
                  <span 
                    *ngFor="let subject of teacher.subjects" 
                    class="badge bg-info">
                    {{ subject.subjectName }} (${{ subject.payPerHour }}/hr)
                  </span>
                </div>
              </td>
              <td>
                <span 
                  class="badge" 
                  [class.bg-success]="teacher.isActive" 
                  [class.bg-secondary]="!teacher.isActive">
                  {{ teacher.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <button 
                    type="button" 
                    class="btn"
                    [class.btn-warning]="teacher.isActive"
                    [class.btn-success]="!teacher.isActive"
                    (click)="toggleTeacherStatus(teacher)"
                    [title]="teacher.isActive ? 'Deactivate' : 'Activate'">
                    <i class="bi" [class.bi-pause-fill]="teacher.isActive" [class.bi-play-fill]="!teacher.isActive"></i>
                  </button>
                  <button 
                    type="button" 
                    class="btn btn-danger"
                    (click)="deleteTeacher(teacher)"
                    title="Delete Teacher">
                    <i class="bi bi-trash-fill"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Add New Teacher Form -->
  <div class="row">
    <div class="col-lg-8 col-md-10 col-12 mx-auto">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="bi bi-person-plus"></i> Add New Teacher
          </h4>
        </div>
        <div class="card-body">
          <form [formGroup]="addTeacherForm" (ngSubmit)="onAddTeacher()">
            
            <!-- Teacher Basic Information -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="teacherName" class="form-label">
                  <i class="bi bi-person"></i> Teacher Name *
                </label>
                <input 
                  type="text" 
                  id="teacherName"
                  placeholder="Enter teacher's full name" 
                  formControlName="teacherName" 
                  class="form-control"
                  [class.is-invalid]="addTeacherForm.get('teacherName')?.invalid && addTeacherForm.get('teacherName')?.touched">
                
                <div *ngIf="addTeacherForm.get('teacherName')?.invalid && addTeacherForm.get('teacherName')?.touched" 
                     class="invalid-feedback">
                  <div *ngIf="addTeacherForm.get('teacherName')?.errors?.['required']">
                    Teacher name is required
                  </div>
                  <div *ngIf="addTeacherForm.get('teacherName')?.errors?.['minlength']">
                    Name must be at least 2 characters long
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <label for="email" class="form-label">
                  <i class="bi bi-envelope"></i> Email Address *
                </label>
                <input 
                  type="email" 
                  id="email"
                  placeholder="teacher@example.com" 
                  formControlName="email" 
                  class="form-control"
                  [class.is-invalid]="addTeacherForm.get('email')?.invalid && addTeacherForm.get('email')?.touched">
                
                <div *ngIf="addTeacherForm.get('email')?.invalid && addTeacherForm.get('email')?.touched" 
                     class="invalid-feedback">
                  <div *ngIf="addTeacherForm.get('email')?.errors?.['required']">
                    Email is required
                  </div>
                  <div *ngIf="addTeacherForm.get('email')?.errors?.['email']">
                    Please enter a valid email address
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="phone" class="form-label">
                  <i class="bi bi-telephone"></i> Phone Number *
                </label>
                <input 
                  type="tel" 
                  id="phone"
                  placeholder="1234567890" 
                  formControlName="phone" 
                  class="form-control"
                  [class.is-invalid]="addTeacherForm.get('phone')?.invalid && addTeacherForm.get('phone')?.touched">
                
                <div *ngIf="addTeacherForm.get('phone')?.invalid && addTeacherForm.get('phone')?.touched" 
                     class="invalid-feedback">
                  <div *ngIf="addTeacherForm.get('phone')?.errors?.['required']">
                    Phone number is required
                  </div>
                  <div *ngIf="addTeacherForm.get('phone')?.errors?.['pattern']">
                    Please enter a valid 10-digit phone number
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <label for="address" class="form-label">
                  <i class="bi bi-geo-alt"></i> Address *
                </label>
                <textarea 
                  id="address"
                  placeholder="Enter complete address" 
                  formControlName="address" 
                  class="form-control"
                  rows="2"
                  [class.is-invalid]="addTeacherForm.get('address')?.invalid && addTeacherForm.get('address')?.touched">
                </textarea>
                
                <div *ngIf="addTeacherForm.get('address')?.invalid && addTeacherForm.get('address')?.touched" 
                     class="invalid-feedback">
                  Address is required
                </div>
              </div>
            </div>

            <!-- Subject Selection -->
            <div class="mb-3">
              <label class="form-label">
                <i class="bi bi-book"></i> Select Subjects * 
                <small class="text-muted">(Click to select/deselect)</small>
              </label>
              
              <div *ngIf="availableSubjects.length === 0" class="alert alert-warning">
                <i class="bi bi-exclamation-triangle"></i>
                No subjects available. Please add subjects first from the Subject Management section.
              </div>
              
              <div *ngIf="availableSubjects.length > 0" class="row">
                <div class="col-12 mb-2">
                  <div class="d-flex flex-wrap gap-2">
                    <button
                      *ngFor="let subject of availableSubjects"
                      type="button"
                      class="btn btn-sm"
                      [class.btn-success]="isSubjectSelected(subject)"
                      [class.btn-outline-secondary]="!isSubjectSelected(subject)"
                      (click)="toggleSubject(subject)">
                      <i class="bi" 
                         [class.bi-check-circle-fill]="isSubjectSelected(subject)"
                         [class.bi-circle]="!isSubjectSelected(subject)"></i>
                      {{ subject.subjectName }} (${{ subject.payPerHour }}/hr)
                    </button>
                  </div>
                </div>
              </div>

              <!-- Selected Subjects Display -->
              <div *ngIf="selectedSubjects.length > 0" class="mt-3">
                <label class="form-label">Selected Subjects:</label>
                <div class="d-flex flex-wrap gap-2">
                  <span 
                    *ngFor="let subject of selectedSubjects" 
                    class="badge bg-primary d-flex align-items-center gap-1">
                    {{ subject.subjectName }} (${{ subject.payPerHour }}/hr)
                    <button 
                      type="button" 
                      class="btn-close btn-close-white" 
                      style="font-size: 0.65em;"
                      (click)="removeSelectedSubject(subject)"
                      title="Remove subject">
                    </button>
                  </span>
                </div>
              </div>

              <div *ngIf="selectedSubjects.length === 0" class="text-danger mt-2">
                <small><i class="bi bi-exclamation-circle"></i> Please select at least one subject</small>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid">
              
              <button 
                type="submit" 
                class="btn btn-primary btn-lg"
                [disabled]="addTeacherForm.invalid || selectedSubjects.length === 0 || !isLoggedInAdmin">
                <i class="bi bi-person-plus-fill"></i> 
                Add Teacher & Generate Credentials
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Credentials Modal -->
<div class="modal fade show d-block" *ngIf="showCredentials" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">
          <i class="bi bi-check-circle-fill"></i> Teacher Added Successfully!
        </h5>
      </div>
      <div class="modal-body" *ngIf="lastGeneratedCredentials">
        <div class="alert alert-info">
          <i class="bi bi-info-circle-fill"></i>
          <strong>Important:</strong> Please save these credentials securely. Share them with the teacher for login.
        </div>
        
        <div class="row">
          <div class="col-12 mb-3">
            <label class="form-label"><strong>Teacher ID:</strong></label>
            <div class="input-group">
              <input 
                type="text" 
                class="form-control" 
                [value]="lastGeneratedCredentials.teacherId" 
                readonly>
              <button 
                class="btn btn-outline-secondary" 
                type="button"
                (click)="copyToClipboard(lastGeneratedCredentials.teacherId)"
                title="Copy to clipboard">
                <i class="bi bi-clipboard"></i>
              </button>
            </div>
          </div>
          
          <div class="col-12 mb-3">
            <label class="form-label"><strong>Password:</strong></label>
            <div class="input-group">
              <input 
                type="text" 
                class="form-control" 
                [value]="lastGeneratedCredentials.password" 
                readonly>
              <button 
                class="btn btn-outline-secondary" 
                type="button"
                (click)="copyToClipboard(lastGeneratedCredentials.password)"
                title="Copy to clipboard">
                <i class="bi bi-clipboard"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle-fill"></i>
          The teacher can use these credentials to log in and view their details.
        </div>
      </div>
      <div class="modal-footer">
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="closeCredentialsModal()">
          <i class="bi bi-check"></i> Got it!
        </button>
      </div>
    </div>
  </div>
</div>